{"abstract":[{"text":"Learn how to prefetch images to improve user experience.","type":"text"}],"variants":[{"paths":["\/documentation\/nuke\/prefetching"],"traits":[{"interfaceLanguage":"swift"}]}],"primaryContentSections":[{"content":[{"level":2,"type":"heading","text":"Overview","anchor":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Loading data ahead of time in anticipation of its use ("},{"isActive":true,"type":"reference","identifier":"https:\/\/en.wikipedia.org\/wiki\/Prefetching"},{"type":"text","text":") is a great way to improve user experience. It’s especially effective for images; it can give users an impression that there is no networking and the images are just magically always there."}]},{"type":"heading","text":"UICollectionView","anchor":"UICollectionView","level":2},{"inlineContent":[{"type":"text","text":"Starting with iOS 10, it became easy to implement prefetching in a "},{"type":"codeVoice","code":"UICollectionView"},{"type":"text","text":" thanks to the "},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewdatasourceprefetching"},{"type":"text","text":" API. All you need to do is set "},{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionview\/1771771-isprefetchingenabled","type":"reference","isActive":true},{"type":"text","text":" to "},{"type":"codeVoice","code":"true"},{"type":"text","text":" and set a "},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionview\/1771768-prefetchdatasource"},{"type":"text","text":"."}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["final class PrefetchingDemoViewController: UICollectionViewController {","    private let prefetcher = ImagePrefetcher()","    private var photos: [URL] = []","","    override func viewDidLoad() {","        super.viewDidLoad()","","        collectionView?.isPrefetchingEnabled = true","        collectionView?.prefetchDataSource = self","    }","}","","extension PrefetchingDemoViewController: UICollectionViewDataSourcePrefetching {","    func collectionView(_ collectionView: UICollectionView, prefetchItemsAt indexPaths: [IndexPath]) {","        let urls = indexPaths.map { photos[$0.row] }","        prefetcher.startPrefetching(with: urls)","    }","","    func collectionView(_ collectionView: UICollectionView, cancelPrefetchingForItemsAt indexPaths: [IndexPath]) {","        let urls = indexPaths.map { photos[$0.row] }","        prefetcher.stopPrefetching(with: urls)","    }","}"]},{"type":"aside","style":"warning","content":[{"inlineContent":[{"type":"text","text":"If you are using any of the processors when displaying the images, e.g. "},{"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImageProcessors\/Resize","type":"reference","isActive":true},{"type":"text","text":", you need to use the same processors for prefetching. Otherwise, the prefetcher will bitmap and cache the original image, defeating the main purpose of prefetching to get images fully ready for display before the user even sees them."}],"type":"paragraph"}],"name":"Warning"},{"inlineContent":[{"type":"text","text":"This code sample comes straight from "},{"identifier":"https:\/\/github.com\/kean\/NukeDemo","type":"reference","isActive":true},{"type":"text","text":"."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Let’s say, there are 32 items on the screen (the last row is partially visible). When you open it for the first time, the prefetch API asks the app to start prefetching for indices "},{"type":"codeVoice","code":"[32-55]"},{"type":"text","text":". As you scroll, the prefetch “window” changes. You receive "},{"type":"codeVoice","code":"cancelPrefetchingForItemsAt"},{"type":"text","text":" calls for items no longer in the prefetch window."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When the user goes to another screen, you can either cancel all the prefetching tasks (but then you’ll need to figure out a way to restart them when the user comes back) or you can also pause them."}]},{"type":"codeListing","code":["override func viewWillAppear(_ animated: Bool) {","    super.viewWillAppear(animated)","","    prefetcher.isPaused = false","}","","override func viewWillDisappear(_ animated: Bool) {","    super.viewWillDisappear(animated)","","    \/\/ When you pause, the prefetcher will finish outstanding tasks","    \/\/ (by default, there are only 2 at a time), and pause the rest.","    prefetcher.isPaused = true","}"],"syntax":"swift"},{"style":"tip","type":"aside","content":[{"inlineContent":[{"text":"Starting with ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/kean\/Nuke\/releases\/tag\/9.5.0","type":"reference"},{"type":"text","text":", you can also change the prefetcher priority. For example, when the user goes to another screen that also has image prefetching, you can lower it to "},{"type":"codeVoice","code":".veryLow"},{"type":"text","text":". This way, the prefetching will continue for both screens, but the top screen will have priority."}],"type":"paragraph"}],"name":"Tip"},{"type":"heading","level":2,"anchor":"ImagePrefetcher","text":"ImagePrefetcher"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You typically create one "},{"isActive":true,"type":"reference","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher"},{"type":"text","text":" per screen."}]},{"inlineContent":[{"type":"text","text":"To start prefetching, call "},{"isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/startPrefetching(with:)-718dg","type":"reference"},{"text":" method. When you need the same image later to display it, simply use the ","type":"text"},{"isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline","type":"reference"},{"type":"text","text":" or view extensions to load the image. The pipeline will take care of coalescing the requests without starting any new downloads:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/startPrefetching(with:)-718dg"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/stopPrefetching(with:)-8cdam"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/stopPrefetching()"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"text":"The prefetcher automatically cancels all of the outstanding tasks when deallocated. All ","type":"text"},{"isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher","type":"reference"},{"text":" methods are thread-safe and are optimized to be used even from the main thread during scrolling.","type":"text"}]},{"content":[{"inlineContent":[{"type":"text","text":"Prefetching takes up users’ data and puts extra pressure on CPU and memory. To reduce the CPU and memory usage, you have an option to choose only the disk cache as a prefetching destination: "},{"isActive":true,"type":"reference","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/Destination\/diskCache"},{"type":"text","text":". It doesn’t require image decoding and processing and therefore uses less CPU. The images are stored on disk, so they also take up less memory. This policy doesn’t work with "},{"isActive":true,"type":"reference","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/DataCachePolicy\/storeEncodedImages"},{"type":"text","text":" cache policy and other policies that affect "},{"type":"codeVoice","code":"loadData()"},{"type":"text","text":"."}],"type":"paragraph"}],"type":"aside","style":"important","name":"Important"}],"kind":"content"}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/prefetching"},"sections":[],"kind":"article","schemaVersion":{"minor":3,"patch":0,"major":0},"metadata":{"roleHeading":"Article","role":"article","modules":[{"name":"Nuke"}],"title":"Prefetching"},"hierarchy":{"paths":[["doc:\/\/com.github.kean.nuke\/documentation\/Nuke"]]},"seeAlsoSections":[{"title":"Performance","identifiers":["doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/performance-guide","doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/combine","doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/caching","doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher"],"anchor":"Performance","generated":true}],"references":{"doc://com.github.kean.nuke/documentation/Nuke/ImagePrefetcher/Destination/diskCache":{"title":"ImagePrefetcher.Destination.diskCache","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"diskCache","kind":"identifier"}],"abstract":[{"type":"text","text":"Prefetches the image data and stores it in disk caches. It does not"},{"text":" ","type":"text"},{"text":"require decoding the image data and therefore requires less CPU.","type":"text"}],"kind":"symbol","role":"symbol","type":"topic","url":"\/documentation\/nuke\/imageprefetcher\/destination\/diskcache","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/Destination\/diskCache"},"doc://com.github.kean.nuke/documentation/Nuke/performance-guide":{"url":"\/documentation\/nuke\/performance-guide","abstract":[{"text":"Learn about the performance features in Nuke and how to make the most of them.","type":"text"}],"type":"topic","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/performance-guide","kind":"article","title":"Performance Guide","role":"article"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePipeline":{"title":"ImagePipeline","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline","kind":"symbol","url":"\/documentation\/nuke\/imagepipeline","type":"topic","role":"symbol","navigatorTitle":[{"kind":"identifier","text":"ImagePipeline"}],"fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"ImagePipeline"}],"abstract":[{"type":"text","text":"The pipeline downloads and caches images, and prepares them for display."}]},"doc://com.github.kean.nuke/documentation/Nuke/caching":{"url":"\/documentation\/nuke\/caching","abstract":[{"type":"text","text":"Learn about cache layers in Nuke and how to configure them."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/caching","type":"topic","kind":"article","title":"Caching","role":"collectionGroup"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePipeline/DataCachePolicy/storeEncodedImages":{"title":"ImagePipeline.DataCachePolicy.storeEncodedImages","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"storeEncodedImages","kind":"identifier"}],"abstract":[{"text":"Encode and store images.","type":"text"}],"kind":"symbol","role":"symbol","url":"\/documentation\/nuke\/imagepipeline\/datacachepolicy\/storeencodedimages","type":"topic","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/DataCachePolicy\/storeEncodedImages"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePrefetcher/stopPrefetching(with:)-8cdam":{"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/stopPrefetching(with:)-8cdam","title":"stopPrefetching(with:)","type":"topic","role":"symbol","url":"\/documentation\/nuke\/imageprefetcher\/stopprefetching(with:)-8cdam","abstract":[{"text":"Stops prefetching images for the given requests and cancels outstanding","type":"text"},{"text":" ","type":"text"},{"text":"requests.","type":"text"}],"fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"stopPrefetching"},{"kind":"text","text":"("},{"kind":"externalParam","text":"with"},{"kind":"text","text":": ["},{"kind":"typeIdentifier","text":"ImageRequest","preciseIdentifier":"s:4Nuke12ImageRequestV"},{"kind":"text","text":"])"}],"kind":"symbol"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePrefetcher":{"title":"ImagePrefetcher","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"ImagePrefetcher","kind":"identifier"}],"abstract":[{"text":"Prefetches and caches images to eliminate delays when requesting the same","type":"text"},{"text":" ","type":"text"},{"text":"images later.","type":"text"}],"kind":"symbol","role":"symbol","navigatorTitle":[{"text":"ImagePrefetcher","kind":"identifier"}],"type":"topic","url":"\/documentation\/nuke\/imageprefetcher","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher"},"doc://com.github.kean.nuke/documentation/Nuke/ImageProcessors/Resize":{"navigatorTitle":[{"text":"Resize","kind":"identifier"}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"Resize","kind":"identifier"}],"url":"\/documentation\/nuke\/imageprocessors\/resize","abstract":[{"type":"text","text":"Scales an image to a specified size."}],"type":"topic","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImageProcessors\/Resize","kind":"symbol","title":"ImageProcessors.Resize","role":"symbol"},"https://developer.apple.com/documentation/uikit/uicollectionview/1771771-isprefetchingenabled":{"title":"isPrefetchingEnabled","type":"link","titleInlineContent":[{"type":"codeVoice","code":"isPrefetchingEnabled"}],"url":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionview\/1771771-isprefetchingenabled","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionview\/1771771-isprefetchingenabled"},"https://github.com/kean/NukeDemo":{"title":"Nuke Demo","type":"link","titleInlineContent":[{"type":"text","text":"Nuke Demo"}],"url":"https:\/\/github.com\/kean\/NukeDemo","identifier":"https:\/\/github.com\/kean\/NukeDemo"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePrefetcher/stopPrefetching()":{"title":"stopPrefetching()","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"stopPrefetching","kind":"identifier"},{"text":"()","kind":"text"}],"abstract":[{"type":"text","text":"Stops all prefetching tasks."}],"kind":"symbol","role":"symbol","type":"topic","url":"\/documentation\/nuke\/imageprefetcher\/stopprefetching()","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/stopPrefetching()"},"https://en.wikipedia.org/wiki/Prefetching":{"title":"prefetching","type":"link","titleInlineContent":[{"type":"text","text":"prefetching"}],"url":"https:\/\/en.wikipedia.org\/wiki\/Prefetching","identifier":"https:\/\/en.wikipedia.org\/wiki\/Prefetching"},"https://developer.apple.com/documentation/uikit/uicollectionview/1771768-prefetchdatasource":{"title":"prefetchDataSource","type":"link","titleInlineContent":[{"type":"codeVoice","code":"prefetchDataSource"}],"url":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionview\/1771768-prefetchdatasource","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionview\/1771768-prefetchdatasource"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePrefetcher/startPrefetching(with:)-718dg":{"title":"startPrefetching(with:)","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"startPrefetching","kind":"identifier"},{"text":"(","kind":"text"},{"text":"with","kind":"externalParam"},{"text":": [","kind":"text"},{"text":"ImageRequest","preciseIdentifier":"s:4Nuke12ImageRequestV","kind":"typeIdentifier"},{"text":"])","kind":"text"}],"abstract":[{"type":"text","text":"Starts prefetching images for the given requests."}],"kind":"symbol","role":"symbol","type":"topic","url":"\/documentation\/nuke\/imageprefetcher\/startprefetching(with:)-718dg","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher\/startPrefetching(with:)-718dg"},"doc://com.github.kean.nuke/documentation/Nuke/combine":{"title":"Combine","url":"\/documentation\/nuke\/combine","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/combine","abstract":[{"type":"text","text":"Learn how to use Combine publishers to improve image loading performance in your apps."}],"role":"article","kind":"article","type":"topic"},"https://developer.apple.com/documentation/uikit/uicollectionviewdatasourceprefetching":{"title":"UICollectionViewDataSourcePrefetching","type":"link","titleInlineContent":[{"type":"codeVoice","code":"UICollectionViewDataSourcePrefetching"}],"url":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewdatasourceprefetching","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewdatasourceprefetching"},"https://github.com/kean/Nuke/releases/tag/9.5.0":{"title":"Nuke 9.5.0","type":"link","titleInlineContent":[{"type":"text","text":"Nuke 9.5.0"}],"url":"https:\/\/github.com\/kean\/Nuke\/releases\/tag\/9.5.0","identifier":"https:\/\/github.com\/kean\/Nuke\/releases\/tag\/9.5.0"},"doc://com.github.kean.nuke/documentation/Nuke":{"title":"Nuke","identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke","kind":"symbol","url":"\/documentation\/nuke","type":"topic","role":"collection","abstract":[{"type":"text","text":"A powerful image loading system for Apple platforms."}]}}}